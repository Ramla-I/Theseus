<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Provides a `thread_local!()` macro, a helper to instantiate lazily-initialized  thread-local storage (TLS) variables."><meta name="keywords" content="rust, rustlang, rust-lang, thread_local_macro"><title>thread_local_macro - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../thread_local_macro/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class="location">Crate thread_local_macro</p><div class="block version"><p>Version 0.1.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all thread_local_macro's items</p></a><div class="block items"><ul><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li></ul></div><p class="location"></p><div id="sidebar-vars" data-name="thread_local_macro" data-ty="mod" data-relpath="../"></div><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="">thread_local_macro</a><button id="copy-path" onclick="copy_path(this)"><img src="../clipboard.svg" width="19" height="18" alt="Copy item import"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/thread_local_macro/lib.rs.html#1-616" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Provides a <code>thread_local!()</code> macro, a helper to instantiate lazily-initialized 
thread-local storage (TLS) variables.</p>
<p>The primary difference between using this crate’s <code>thread_local!()</code> macro
and directly using the <code>#[thread_local]</code> attribute is that <code>static</code> items
tagged with the <code>#[thread_local]</code> attribute will <em>never</em> be dropped,
just like all other <code>static</code>s.</p>
<p>However, static items defined in a <code>thread_local!()</code> macro block will be
destructed (e.g., dropped, destroyed) when that task exits.</p>
<h1 id="rust-std-based-implementation-notes" class="section-header"><a href="#rust-std-based-implementation-notes">Rust std-based implementation notes</a></h1>
<p>The code in this crate is adapted from <a href="https://github.com/rust-lang/rust/blob/3f14f4b3cec811017079564e16a92a1dc9870f41/library/std/src/thread/local.rs">this version of the <code>thread_local!()</code> macro</a>
from the Rust standard library.
The main design has been left unchanged, but we have removed most of the configuration blocks
for complex platform-specific or OS-specific behavior.
Because Theseus supports the <code>#[thread_local]</code> attribute, we can directly use the 
TLS “fast path”, which the Rust standard library refers to as the “FastLocalInnerKey”.</p>
<h2 id="unsafety" class="section-header"><a href="#unsafety">Unsafety</a></h2>
<p>We could probably could remove most of the unsafe code from this implementation,
because we don’t have to account for the various raw platform-specific interfaces 
or using raw libc types like the original Rust std implementation does.
However, I have chosen to leave the code as close as possible to the original 
Rust std implementation in order to make updates as easy as possible,
for if and when the Rust std version changes and we wish to track/merge in those changes.</p>
</div></details><h2 id="macros" class="section-header"><a href="#macros">Macros</a></h2>
<table><tr class="module-item"><td><a class="macro" href="macro.thread_local.html" title="thread_local_macro::thread_local macro">thread_local</a></td><td class="docblock-short"><p>Declare a new thread local storage key of type <a href="struct.LocalKey.html" title="LocalKey"><code>LocalKey</code></a>.</p>
</td></tr></table><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.AccessError.html" title="thread_local_macro::AccessError struct">AccessError</a></td><td class="docblock-short"><p>An error returned by <a href="struct.LocalKey.html#method.try_with"><code>LocalKey::try_with</code></a>.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.LocalKey.html" title="thread_local_macro::LocalKey struct">LocalKey</a></td><td class="docblock-short"><p>A thread-local storage key which owns its contents.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="thread_local_macro" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script></body></html>